<%
function renderMemberRow(m) {
  const roleColors = {
    OWNER: 'bg-primary/10 text-primary',
    ADMIN: 'bg-blue-500/10 text-blue-400',
    MEMBER: 'bg-muted text-muted-foreground'
  };
  const roleColor = roleColors[m.role] || roleColors.MEMBER;
  
  return `
    <div class="flex items-center justify-between p-4">
      <div class="flex items-center gap-3">
        <div class="flex h-10 w-10 items-center justify-center rounded-full bg-muted font-medium text-sm">
          ${m.user.name.substring(0, 2).toUpperCase()}
        </div>
        <div>
          <p class="font-medium">${m.user.name}</p>
          <p class="text-sm text-muted-foreground">${m.user.email}</p>
        </div>
      </div>
      <span class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold ${roleColor}">
        ${m.role}
      </span>
    </div>
  `;
}

let bodyContent = `
<div class="container max-w-3xl py-6">
  <div class="mb-8">
    <a href="/project/${project.id}/board" class="inline-flex items-center text-sm text-muted-foreground hover:text-foreground mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-4 w-4 mr-1"><path d="m15 18-6-6 6-6"/></svg>
      Back to Board
    </a>
    <h1 class="text-3xl font-bold tracking-tight">${project.name}</h1>
    <p class="text-muted-foreground">Project settings and configuration</p>
  </div>
  
  <form action="/project/${project.id}/settings" method="POST" class="space-y-8">
    <input type="hidden" name="_csrf" value="${csrfToken}">
    
    <!-- Basic Info -->
    <div class="rounded-lg border bg-card">
      <div class="p-6 border-b">
        <h3 class="font-semibold">Basic Information</h3>
        <p class="text-sm text-muted-foreground">Update your project details</p>
      </div>
      <div class="p-6 space-y-4">
        <div class="space-y-2">
          <label for="name" class="text-sm font-medium leading-none">Project Name</label>
          <input type="text" id="name" name="name" value="${project.name}" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm" required>
        </div>
        <div class="space-y-2">
          <label for="description" class="text-sm font-medium leading-none">Description</label>
          <textarea id="description" name="description" rows="3" class="flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-y">${project.description || ''}</textarea>
        </div>
      </div>
    </div>
    
    <!-- GitHub Integration -->
    <div class="rounded-lg border bg-card">
      <div class="p-6 border-b">
        <h3 class="font-semibold flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-5 w-5"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
          GitHub Integration
        </h3>
        <p class="text-sm text-muted-foreground">Connect your repository for AI code generation</p>
      </div>
      <div class="p-6 space-y-4">
        <div class="space-y-2">
          <label for="githubRepoUrl" class="text-sm font-medium leading-none">Repository URL</label>
          <input type="url" id="githubRepoUrl" name="githubRepoUrl" value="${project.githubRepoUrl || ''}" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm" placeholder="https://github.com/org/repo">
          <p class="text-xs text-muted-foreground">Cursor Cloud Agent handles GitHub authentication automatically</p>
        </div>
      </div>
    </div>
    
    <!-- AI Configuration -->
    <div class="rounded-lg border bg-card">
      <div class="p-6 border-b">
        <h3 class="font-semibold flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-5 w-5"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
          AI Configuration
        </h3>
        <p class="text-sm text-muted-foreground">Configure Cursor Cloud Agent behavior</p>
      </div>
      <div class="p-6 space-y-4">
        <div class="space-y-2">
          <label for="cursorApiKey" class="text-sm font-medium leading-none">
            Cursor API Key
            ${project.hasApiKey ? '<span class="text-green-400 text-xs ml-2">(configured)</span>' : ''}
          </label>
          <input type="password" id="cursorApiKey" name="cursorApiKey" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono" placeholder="${project.hasApiKey ? '••••••••••••••••' : 'key_xxxxx...'}">
          <p class="text-xs text-muted-foreground">Leave empty to keep current.</p>
        </div>
        <div class="space-y-2">
          <label for="systemPrompt" class="text-sm font-medium leading-none">System Prompt</label>
          <textarea id="systemPrompt" name="systemPrompt" rows="6" class="flex min-h-[120px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono resize-y" placeholder="Instructions for the AI agent (coding standards, tech stack, etc.)">${project.systemPrompt || ''}</textarea>
          <p class="text-xs text-muted-foreground">This context will be included in every AI task</p>
        </div>
        <div class="space-y-2">
          <label for="monthlyBudgetCents" class="text-sm font-medium leading-none">Monthly Budget (cents)</label>
          <input type="number" id="monthlyBudgetCents" name="monthlyBudgetCents" value="${project.monthlyBudgetCents}" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm" min="0" max="1000000">
          <p class="text-xs text-muted-foreground">\$${(project.monthlyBudgetCents / 100).toFixed(2)} USD monthly API cost limit</p>
        </div>
      </div>
    </div>
    
    <!-- Team Members -->
    <div class="rounded-lg border bg-card">
      <div class="p-6 border-b">
        <h3 class="font-semibold">Team Members</h3>
        <p class="text-sm text-muted-foreground">${project.members.length} member${project.members.length !== 1 ? 's' : ''}</p>
      </div>
      <div class="divide-y">
`;

for (const m of project.members) {
  bodyContent += renderMemberRow(m);
}

bodyContent += `
      </div>
    </div>
    
    <div class="flex items-center justify-between">
      <button type="submit" class="inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
        Save Changes
      </button>
    </div>
  </form>
  
  ${membership.role === 'OWNER' ? `
    <div class="mt-8 rounded-lg border border-destructive/50 bg-destructive/5">
      <div class="p-6 border-b border-destructive/20">
        <h3 class="font-semibold text-destructive">Danger Zone</h3>
        <p class="text-sm text-muted-foreground">Irreversible actions</p>
      </div>
      <div class="p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="font-medium">Delete Project</p>
            <p class="text-sm text-muted-foreground">Permanently delete this project and all ${project._count.tickets} tickets</p>
          </div>
          <form action="/project/${project.id}/delete" method="POST" onsubmit="return confirm('Are you sure? This cannot be undone.')">
            <input type="hidden" name="_csrf" value="${csrfToken}">
            <button type="submit" class="inline-flex items-center justify-center rounded-md text-sm font-medium bg-destructive text-destructive-foreground hover:bg-destructive/90 h-9 px-3">
              Delete Project
            </button>
          </form>
        </div>
      </div>
    </div>
  ` : ''}
</div>
`;
%>
<%- include('../layout', { body: bodyContent, title, csrfToken, isAuthenticated: true, user, currentPath }) %>
