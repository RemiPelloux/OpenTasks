<%
function renderRecentUser(u) {
  const roleColors = {
    SUPER_ADMIN: 'bg-destructive/10 text-destructive',
    ADMIN: 'bg-blue-500/10 text-blue-400',
    MEMBER: 'bg-muted text-muted-foreground'
  };
  const roleColor = roleColors[u.role] || roleColors.MEMBER;
  
  return `
    <div class="flex items-center justify-between p-4">
      <div class="flex items-center gap-3">
        <div class="flex h-10 w-10 items-center justify-center rounded-full bg-muted font-medium">
          ${u.name.substring(0, 2).toUpperCase()}
        </div>
        <div>
          <p class="font-medium">${u.name}</p>
          <p class="text-sm text-muted-foreground">${u.email}</p>
        </div>
      </div>
      <div class="flex items-center gap-4 text-sm">
        <span class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold ${roleColor}">
          ${u.role}
        </span>
        <span class="text-muted-foreground">${new Date(u.createdAt).toLocaleDateString()}</span>
      </div>
    </div>
  `;
}

let bodyContent = `
<div class="container py-6">
  <div class="mb-8">
    <h1 class="text-3xl font-bold tracking-tight">Admin Dashboard</h1>
    <p class="text-muted-foreground">Manage users, invite codes, and system settings</p>
  </div>
  
  <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-8">
    <div class="rounded-lg border bg-card p-6">
      <div class="flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-4 w-4 text-muted-foreground"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        <span class="text-sm font-medium text-muted-foreground">Total Users</span>
      </div>
      <div class="mt-2 text-3xl font-bold">${stats.users}</div>
    </div>
    
    <div class="rounded-lg border bg-card p-6">
      <div class="flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-4 w-4 text-muted-foreground"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg>
        <span class="text-sm font-medium text-muted-foreground">Projects</span>
      </div>
      <div class="mt-2 text-3xl font-bold">${stats.projects}</div>
    </div>
    
    <div class="rounded-lg border bg-card p-6">
      <div class="flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-4 w-4 text-muted-foreground"><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/></svg>
        <span class="text-sm font-medium text-muted-foreground">Tickets</span>
      </div>
      <div class="mt-2 text-3xl font-bold">${stats.tickets}</div>
    </div>
    
    <div class="rounded-lg border bg-card p-6">
      <div class="flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-4 w-4 text-muted-foreground"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
        <span class="text-sm font-medium text-muted-foreground">Active Invites</span>
      </div>
      <div class="mt-2 text-3xl font-bold">${stats.invites}</div>
    </div>
  </div>
  
  <div class="grid gap-4 md:grid-cols-2 mb-8">
    <a href="/admin/users" class="flex items-center justify-between rounded-lg border bg-card p-6 hover:border-primary/20 transition-colors">
      <div>
        <h3 class="font-semibold">Manage Users</h3>
        <p class="text-sm text-muted-foreground">View, edit, and manage user accounts</p>
      </div>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-5 w-5 text-muted-foreground"><path d="m9 18 6-6-6-6"/></svg>
    </a>
    
    <a href="/admin/invites" class="flex items-center justify-between rounded-lg border bg-card p-6 hover:border-primary/20 transition-colors">
      <div>
        <h3 class="font-semibold">Invite Codes</h3>
        <p class="text-sm text-muted-foreground">Create and manage invite codes</p>
      </div>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-5 w-5 text-muted-foreground"><path d="m9 18 6-6-6-6"/></svg>
    </a>
  </div>
  
  <div class="rounded-lg border bg-card">
    <div class="p-6 border-b">
      <h3 class="font-semibold">Recent Users</h3>
    </div>
    <div class="divide-y">
`;

for (const u of recentUsers) {
  bodyContent += renderRecentUser(u);
}

bodyContent += `
    </div>
    <div class="p-4 border-t">
      <a href="/admin/users" class="text-sm text-primary hover:underline">View all users â†’</a>
    </div>
  </div>
</div>
`;
%>
<%- include('../layout', { body: bodyContent, title, csrfToken, isAuthenticated: true, user, currentPath }) %>
